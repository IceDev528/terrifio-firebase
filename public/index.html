<!DOCTYPE html>
<html lang="en">
<head>

  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/css/uikit.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/js/uikit.min.js"></script>

  <link rel="icon" href="/wp-content/uploads/2019/04/cropped-ms-icon-310x310-32x32.png" sizes="32x32">
  <link rel="apple-touch-icon" sizes="57x57" href="logo/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="logo/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="logo/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="logo/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="logo/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="logo/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="logo/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="logo/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="logo/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="logo/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="logo/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="logo/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="logo/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="logo/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- <link rel="stylesheet" href="./css/style.css" /> -->
  <link rel="stylesheet" href="./css/notyf.min.css" />
  <link rel="stylesheet" type="text/css" href="./css/dashboard.css?v=1.0">
  <script src="./js/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-firestore.js"></script>
  <script type="text/javascript" src="./js/firebase_init.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="./js/uikit-icons.min.js" ></script>
  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
      var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
      s1.async=true;
      s1.src='https://embed.tawk.to/5cd1f2bdd07d7e0c639267a6/default';
      s1.charset='UTF-8';
      s1.setAttribute('crossorigin','*');
      s0.parentNode.insertBefore(s1,s0);
    })();
  </script>
  <!--End of Tawk.to Script-->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137827565-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-137827565-2');
  </script>
  <!-- Hotjar Tracking Code for https://platform.terrifio.co.uk -->
  <script>
    (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:1428836,hjsv:6};
      a=o.getElementsByTagName('head')[0];
      r=o.createElement('script');r.async=1;
      r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
      a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>

  <style type="text/css">
    .reportCard{
      background-color: #f8f9fe;
    }
    article{
      color: #666 !important;
    }
    img.vert-move {
      -webkit-animation: mover 1s infinite  alternate;
      animation: mover 1s infinite  alternate;
    }
    img.vert-move {
      -webkit-animation: mover 1s infinite  alternate;
      animation: mover 1s infinite  alternate;
    }
    @-webkit-keyframes mover {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
    @keyframes mover {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
    #nav-top{

      float:right;

    }

    #sidebar{
      top:0px;
      max-width:15% !important;
    }
    .nav-shrink{
      margin-left: 15% !important;

    }
    .uk-button-primary{
      background-color:#4054be !important;
    }
    .horizontal-center{
      margin-top: 50vh;
    }
    .floating {  
      animation-name: floating;
      animation-duration: 3s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
      width:30px;
    }

    @keyframes floating {
      from { transform: translate(0,  0px); }
      65%  { transform: translate(0, 15px); }
      to   { transform: translate(0, -0px); }    
    }
    #my-id > .uk-modal-dialog{
      height:100vh;
      top: -10px;
      overflow: hidden;

    }
    .pre-load{
      height: 100%;
      width: 100%;
      z-index: 999999;
      position: absolute;
    }
    #proCard{
      margin-top: 30px;
      margin-bottom: 30px;
    }
  </style>
  <script type="text/javascript">
  </script>
  <script>

    UIkit.util.ready(function(){
      var loadValue = 10;
      var animate = setInterval(function () {

        loadValue += 10;

        switch(true){
          case loadValue <= 30:
          jQuery('#loadingInfo').text('Loading Page Content...');
          break;
          case loadValue <= 50 && loadValue > 30:
          jQuery('#loadingInfo').text('Securing Connection...');
          break;
          case loadValue > 50 && loadValue <= 100:
          jQuery('#loadingInfo').text('Rendering Data...');
          break;
        }

        jQuery('#js-loading').val(loadValue);

        if (loadValue >= 100) {
          clearInterval(animate);
          $('main').removeClass('uk-hidden');
          $('.pre-load').addClass('uk-animation-slide-bottom uk-hidden');
          var confirmState = false;
                  if(currentUser && currentUser.uid){

          let userID = currentUser.uid;
          firebase.database().ref('user/' + userID + '/reports/').on('value', function (snapshot) {
            console.log(snapshot.val());
            if(snapshot.val()){
              //ready();
            }
          });
        }
          
        }

      }, 200);

    });
    var currentUser
    // The original Firestripe project used Vue so I copied the data object
    var data = {
      currentUser: null,
      sources: {},
      stripeCustomerInitialized: false,
      newCreditCard: {
        number: '',
        cvc: '',
        exp_month: 0,
        exp_year: 0000,
        address_zip: ''
      },
      charges: {},
      newCharge: {
        source: null,
        discount: ''
      }
    };
    var userDataObject
    var report_available = false
    firebase.auth().onAuthStateChanged(function(user){
      if(user){
        currentUser = firebase.auth().currentUser;
        if (user.emailVerified) {
          console.log('Email is verified');
        }
        else {
          console.log('Email is not verified');
        }

        firebase.database().ref('user/'+currentUser.uid).on('value', function(snapshot){
          userDataObject = snapshot.val();


          //Hide and display the account bar if the user isn't subscribed.
          if (userDataObject.userMeta.subscribed != true){
            $('.upgradeNotice').removeClass('uk-hidden');
            $('.newProject').attr('href', '#');
            $('.newProject').attr('onClick', 'UIkit.modal("#modal-card").show(); UIkit.notification(" This is for members only, please upgrade for access " ,{status: "warning"});')
          }else if (userDataObject.userMeta.subscribed == true){
            $('.newProject').attr('href', '/digitalipadvisor');
            if (userDataObject.userMeta.firstDash != false){
              setTimeout(function(){UIkit.modal('#modal-sections').show()},10000);
              firebase.database().ref('user/'+currentUser.uid+'/userMeta').update({'firstDash':false});
            }
          }

          data.currentUser = currentUser;
          initStripeCustomer();
        })
        
        
        $('.profile-img').attr("src","" + currentUser.photoURL);
        $('.user-name').text(currentUser.displayName);
        $('.name-upload').attr("placeholder", currentUser.displayName);
      }else{
        window.location.href="/login";
      }
    });
    function submitFirmInfo(){
      var data = {}
      data.firmName = $('.firmInput').val();
      firebase.database().ref('user/'+ currentUser.uid + 'userMeta').update({data});
    }
    
    var initStripeCustomer = () => {
      firebase.firestore().collection('stripe_customers').doc(`${data.currentUser.uid}`).onSnapshot(snapshot => {
        data.stripeCustomerInitialized = (snapshot.data() !== null);
      }, () => {
        data.stripeCustomerInitialized = false;
      });
    }
  </script>
</head>
<body>
  <div class="pre-load uk-inline uk-animation-reverse">
    <div class="uk-position-center uk-overlay">
      <img class="floating uk-align-center" style="width:100px;" src="./images/logo.png">
      <progress id="js-loading" class="uk-progress" value="10" max="100"></progress>
      <h4 class="uk-h4">Welcome to Terrifio&trade;!</h4>
      <p id="loadingInfo">Loading Please Wait...</p>
    </div>
  </div>
  <main class="uk-hidden">
    <!--HEADER-->
    <header id="top-head" class="uk-position-fixed">
      <div style="min-height:50px;" class="uk-container uk-container-expand uk-background-primary">
        <nav class="uk-navbar uk-light" data-uk-navbar="mode:click; duration: 250">
          <div class="uk-navbar-left">
            <div class="uk-navbar-item uk-hidden@m">
              <a class="uk-logo" href="/"><img class="custom-logo" src="./images/logo.png" alt=""></a> 
            </div>
            <ul class="uk-navbar-nav uk-visible@m">
              <li>
                <a href="#">Settings <span data-uk-icon="icon: triangle-down"></span></a>
                <div class="uk-navbar-dropdown">
                  <ul class="uk-nav uk-navbar-dropdown-nav">
                    <li class="uk-nav-header">Your Account</li>
                    <li><a href="/account"><span data-uk-icon="icon: settings"></span> Settings</a></li>
                    <li class="uk-nav-divider"></li>
                    <li><a href="/user"><span data-uk-icon="icon: image"></span> Your Profile</a></li>
                    <li class="uk-nav-divider"></li>
                    <li><a onClick="firebase.auth().signOut();"><span data-uk-icon="icon: sign-out"></span> Logout</a></li>
                  </ul>
                </div>
              </li>
            </ul>
            <div class="uk-navbar-item uk-visible@s">
            </div>
          </div>
          <div class="uk-navbar-right">
            <ul class="uk-navbar-nav">
              <li class="uk-visible@m"><a href="/user" data-uk-icon="icon:user" title="Your profile" data-uk-tooltip></a></li>
              <li class="uk-visible@m"><a href="/account" data-uk-icon="icon: settings" title="Settings" data-uk-tooltip></a></li>
              <li class="uk-visible@m"><a onClick="logout();" data-uk-icon="icon:  sign-out" title="Sign Out" data-uk-tooltip></a></li>
              <li><a class="uk-navbar-toggle uk-hidden@m" uk-toggle="target: #left-col; cls: uk-visible@m" data-uk-navbar-toggle-icon title="Menu" data-uk-tooltip></a></li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!--/HEADER-->
    <!-- LEFT BAR -->
    <aside id="left-col" class="uk-light uk-visible@m">
      <div class="left-logo uk-align-center uk-flex uk-flex-middle">
        <a href="/"><img class="custom-logo" src="./images/logo.png" alt=""></a>
        <h4 class="uk-h4" style="padding-bottom: 15px;">Terrifio &trade;</h4>
      </div>
      <div class="left-content-box  content-box-dark">
        <a href="/user">
          <img src="" alt="" class="uk-border-circle profile-img">
        </a>
        
        <h4 class="uk-text-center uk-margin-remove-vertical text-light"></h4>
        
        <div class="uk-position-relative uk-text-center uk-display-block">
          <a href="#" class="uk-text-small uk-text-muted user-name uk-display-block uk-text-center" data-uk-icon="icon: triangle-down; ratio: 0.7">User</a>
          <!-- user dropdown -->
          <div class="uk-dropdown user-drop" data-uk-dropdown="mode: click; pos: bottom-center; animation: uk-animation-slide-bottom-small; duration: 150">
            <ul class="uk-nav uk-dropdown-nav uk-text-left">
              <li><a href="/account"><span data-uk-icon="icon: settings"></span> Settings</a></li>
              <li class="uk-nav-divider"></li>
              <li><a href="/user"><span data-uk-icon="icon: image"></span> Your Profile</a></li>
              <li class="uk-nav-divider"></li>
              <li><a onClick="firebase.auth().signOut();"><span data-uk-icon="icon: sign-out"></span> Logout</a></li>
            </ul>
          </div>
          <!-- /user dropdown -->
        </div>
      </div>
      
      <div class="left-nav-wrap">
        <ul class="uk-nav uk-nav-default uk-nav-parent-icon" data-uk-nav>
          <li class="uk-nav-header">ACTIONS</li>
          <li><a href="/"><span data-uk-icon="icon: thumbnails" class="uk-margin-small-right"></span>Dashboard</a></li>
          <li><a href="/calculator"><span data-uk-icon="icon: credit-card" class="uk-margin-small-right"></span>Cost Forecaster</a></li>
<!--           <li><a class="uk-disabled" title="Coming Soon" href="#"><span data-uk-icon="icon: calendar" class="uk-margin-small-right"></span>Calendar</a>
          </li> -->
          <li class="uk-parent">
            <a href="#"><span data-uk-icon="icon: comments" class="uk-margin-small-right"></span>Info</a>
            <ul class="uk-nav-sub">
              <li><a href="/privacy">Privacy Policy</a></li>
              <li><a href="/terms">Terms & Conditions</a></li>
            </ul>
          </li>
        </ul>
        <div class="left-content-box uk-margin-top">
        </div>
        
      </div>
      <div class="bar-bottom">
        <ul class="uk-subnav uk-flex uk-flex-center uk-child-width-1-5" data-uk-grid>
          <li>
            <a href="/" class="uk-icon-link" data-uk-icon="icon: home" title="Home" data-uk-tooltip></a>
          </li>
          <li>
            <a href="/account" class="uk-icon-link" data-uk-icon="icon: settings" title="Settings" data-uk-tooltip></a>
          </li>
          
          <li>
            <a onClick="firebase.auth().signOut();" class="uk-icon-link" data-uk-tooltip="Sign out" data-uk-icon="icon: sign-out"></a>
          </li> 
        </ul>
      </div>
    </aside>
    <!-- /LEFT BAR -->
    <script type="text/javascript">
      function deleteReport(reportID, formName) {
        if (confirm('Are you sure you wish to delete ' + formName + '?') == true) {
          var parent = database.ref('user/' + currentUser.uid + '/reports/' + reportID);
          parent.on('child_removed', function (snapshot) {
            console.log(snapshot);
          });
          parent.remove();
        }
      }
    </script> 
    <link href="./datedropper/datedropper.css" rel="stylesheet" type="text/css" />
    <script src="./datedropper/datedropper.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./css/datepicker.css">
    <script src="https://unpkg.com/ionicons@4.5.0/dist/ionicons.js"></script>

    <!-- CONTENT -->

    <div id="content" class="uk-background-cover uk-overlay uk-overlay-cover uk-overlay-default " style="background-image: url('./images/background.jpg')" data-uk-height-viewport="expand: true">
      <div uk-alert="" style="background:#222A30; color:white;" class=" uk-hidden upgradeNotice uk-alert">
        <a class="uk-alert-close uk-close uk-icon" uk-close=""><svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" data-svg="close-icon"><line fill="none" stroke="#000" stroke-width="1.1" x1="1" y1="1" x2="13" y2="13"></line><line fill="none" stroke="#000" stroke-width="1.1" x1="13" y1="1" x2="1" y2="13"></line></svg></a>
        <div class="uk-grid" uk-grid></div>
        <div>
          <h3>Welcome to Terrifio!</h3>
          <p>You are using the beta version of Terrifio&trade;. 
          </br>We are currently asking for users to fill out a brief survey instead of a subscription. <a href="#" onClick="UIkit.modal('#modal-form').show();">Click here to upgrade.</a></p>
        </div>
      </div>
      <div id="pro_dash" class="uk-container uk-hidden uk-container-expand">
        <div class="uk-grid uk-grid-medium" data-uk-grid>
          <div id="campaigns" class="uk-width-1-2@l">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover">
              <div class="uk-card-header">
                Lead Campaigns <span><!-- Todo: Question mark drop with text like calculator --></span>
              </div>
              <div class="uk-card-body">
                <p>Here you can set up a Lead Campaign. Click <a href="#leadHowTo">Here</a> to learn more. Lead campaigns will let you qualify and educate leads before you work with them.</p>
                <button onClick="createCampaign()" class="uk-button uk-button-primary">Start New Campaign</button>
                <div id="leadCampaigns">
                  <ul></ul>
                </div>

              </div>
              <div class="uk-card-footer">

              </div>
            </div>
          </div>
          <div id="leadFeed" class="uk-width-1-2@l">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover">
              <div class="uk-card-header">
                New Leads <span><!-- Todo: Question mark drop with text like calculator --></span>
              </div>
              <div class="uk-card-body">
                <p>Here new leads will show up as they come into our system. To start finding new leads please fill out your search criteria here.</p>
                <button class="uk-button uk-button-primary">Set Lead Criteria</button>
              </div>
              <div class="uk-card-footer">

              </div>
            </div>
          </div>
        </div>
        <div class="uk-grid uk-grid-medium" data-uk-grid>
          <div id="campaigns" class="uk-width-1-2@l">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover">
              <div class="uk-card-header">
               Firm Information <span><!-- Todo: Question mark drop with text like calculator --></span>
             </div>
             <div class="uk-card-body">
              <p>Here you can fill out information about your firm. This will change how Terrifio &trade; looks for users who sign up with your referral link.</p>
              <form method="post" action="javascript:submitFirmInfo();">
                <div class="uk-margin">
                 <label for="firmName">Firm or Associate Name</label>
                 <input class="firmInput" type="text" name="firmName">
               </div>
               <button type="submit" class="uk-button uk-button-primary">Update Firm Information</button>
             </form>
           </div>
           <div class="uk-card-footer">

           </div>
         </div>
       </div>
     </div>
   </div>
   <div id="starter" class="uk-container uk-width-1-1@m uk-align-center uk-container-expand">
    <div class="uk-child-width-1-2@m" uk-grid>
      <div>
        <div class="uk-card uk-card-default uk-card-large uk-card-body">
          <h3 class="uk-card-title uk-text-center">The Digital IP Advisor</h3>
          <img src="./images/marketing-2-p.svg">

          <a href="/digitalipadvisor" class="newProject" style="margin-top: 10px;"><button class="uk-button uk-button-primary uk-padding-small uk-align-center">New Project</button></a>

          <p>The Digital IP Advisor helps you understand how to make the most of your patent journey, with important information and dates you need to know.</p> 
        </div>
      </div>
      <div>     
       <div class="uk-card uk-card-default uk-card-large uk-card-body">
        <h3 class="uk-card-title uk-text-center">Digital IP Forecaster</h3>
        <img src="./images/marketing-1-p.svg">

        <a href="/calculator" class="" style="margin-top: 10px;"><button class="uk-button uk-button-primary uk-padding-small uk-align-center">Forecaster</button></a>

        <p>The Forecaster helps you understand the costs associated with filing a patent.
          <br/>
          <br/>          
        </p>
      </div>
    </div>
  </div>
</div>

<div id="inventor_dash" class="uk-container uk-hidden uk-container-expand">

  <hr>
  <div class="uk-grid uk-grid-medium" data-uk-grid>

   <!-- panel -->
   <div id="reports" class="uk-width-2-3@l">
    <div class="uk-card uk-card-default uk-card-small uk-card-hover">
     <div class="uk-card-header">
      <div class="uk-grid uk-grid-small">
       <div class="uk-width-auto"><h4>Projects</h4></div>
       <div class="uk-width-expand uk-text-right panel-icons">
         <a href="#" class="uk-icon-link newProject newProject" title="New Project" data-uk-tooltip data-uk-icon="icon: plus"></a>
       </div>
     </div>
   </div>
   <div class="uk-card-body">
     <div id="reportTable" class="">
      <ul class="uk-switcher" id="reportData">

      </ul>

      <ul id="reportSub" uk-switcher="animation: uk-animation-fade; connect: #reportData" class="uk-subnav uk-flex-center uk-pagination">
      </ul>  
    </div>

  </div>
</div>
</div>
<!-- /panel -->
<!-- panel -->
<div id="rightCard" class="uk-width-1-3@l">
 <div class="uk-card uk-card-default uk-card-small uk-card-hover">
  <div class="uk-card-header">
   <div class="uk-grid uk-grid-small">
    <div class="uk-width-auto"><h4>New Project</h4></div>
    <div class="uk-width-expand uk-text-right panel-icons">
     <a href="#" class="uk-icon-link" title="Close" data-uk-tooltip data-uk-icon="icon: cross"></a>
   </div>
 </div>
</div>
<div id="newProBody" class="uk-card-body">
 <img src="./images/marketing-2-p.svg">
 <a href="#" class="newProject"><button class="uk-button uk-button-primary uk-padding-small uk-align-center">New Project</button></a>
 <p class="uk-article">To start click on 'New Project' Above.</p>        
</div>

</div>
</div>
<!-- This has been removed temporarily -->
<!--            <div id="proCard" class="uk-width-2-3@l">
             <div class="uk-card uk-card-default uk-card-small uk-card-hover">
              <div class="uk-card-header">
               <div class="uk-grid uk-grid-small">
                <div class="uk-width-auto"><h4>How do I connect with an IP Professional?</h4></div>
                <div class="uk-width-expand uk-text-right panel-icons">
                  
                    	<a href="#" class="uk-icon-link" title="Close" data-uk-tooltip data-uk-icon="icon: cross"></a>
                    </div>
                  </div>
                </div>
                <div id="newProBody" class="uk-card-body">
                 <p>To start, Select a Report. Then press “Start”. Your answers will be additional Project Criteria which IP
                 Professionals may consider when determining if they are able to help you.</p>
                 <div>
                   <select class="uk-select uk-float-left uk-width-1-2@m" id="reportSelect">
                    <option value="none">Please Select a report</option>
                  </select>
                  <a href="#" onClick="if(jQuery('#reportSelect').val() != 'none'){document.location.href ='/proform?report=' + jQuery('#reportSelect').val()}" class="uk-width-1-2@m uk-float-right"><button class=" uk-button uk-button-primary uk-padding-small uk-align-center">Start</button></a>
</div>


              </div>

            </div>
          </div> -->
          <!-- /panel -->
        </script>
      </div>
    </div>
  </div>
  <div id="modal-payment" uk-modal>
    <div class="uk-modal-dialog">

    </div>
    <div class="uk-modal-body">




    </div>
  </div>
  <script type="text/javascript">
    function submitForm() {
      var formdata = $("form").serializeArray();
      var data = {};
      $(formdata).each(function(index, obj){
        data[obj.name] = obj.value;
      });
      writeUserData(data,firebase.auth().currentUser.uid);
    }

    function writeUserData(data, userID){
      firebase.database().ref('subSurvey/' + userID).update({'' : data},function(error){
        if(error){
          console.log(error);
        }
        else{
        }
      })
    }
  </script>
  <div id="modal-form" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
      <h2 class="uk-modal-title">Survey</h2>
      <form class="" action="javascript:submitForm();" method="post">
        <fieldset class="uk-fieldset">
         <div class="uk-margin">
          <label class="uk-form-label">Name</label>			
          <input class="uk-input" type="text" name="name" placeholder="Name">
        </div>
        <div class="uk-margin">
          <label class="uk-form-label">Email</label>			
          <input type="text" class="uk-input" name="email" placeholder="Email">
        </div>
        <div class="uk-margin">
          <label class="uk-form-label">Phone Number</label>
          <input type="text" class="uk-input"  name="phone" placeholder="Phone Number">
        </div>
      </fieldset>
      <fieldset class="uk-fieldset">
       <div class="uk-margin uk-form-horizontal">
        <label class="uk-form-label">Can we contact you to follow up on this survey?</label>

        <br>

        <label class="uk-form-label"><input type="radio" class="uk-radio" value="Email & Phone" name="radio_contact"> Yes (Email, Phone) </label>
        <label class="uk-form-label"><input type="radio" class="uk-radio" value="Email" name="radio_contact"> Yes (Email) </label>
        <label class="uk-form-label"><input type="radio" class="uk-radio" value="Phone" name="radio_contact"> Yes (Phone) </label>
        <label class="uk-form-label"><input type="radio" class="uk-radio" value="No" name="radio_contact"> No </label>

      </div>
    </fieldset>
    <fieldset class="uk-fieldset">
     <div class="uk-margin uk-form-horizontal">
      <label class="uk-form-label">How did you find out about Terrifio?</label>

      <br>

      <label class="uk-form-label"><input type="checkbox" class="uk-checkbox" value="Google" name="find_site"> Google </label>
      <label class="uk-form-label"><input type="checkbox" class="uk-checkbox" value="Other" name="find_site"> Other Search Engine </label>
      <label class="uk-form-label"><input type="checkbox" class="uk-checkbox" value="Google Ad" name="find_site"> Google Advertisment </label>
      <label class="uk-form-label"><input type="checkbox" class="uk-checkbox" value="Referral" name="find_site"> Referral </label>
      <label class="uk-form-label"><input type="checkbox" class="uk-checkbox" value="Professional" name="find_site"> A Patent Professional / Firm </label>
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">How clear is Terrifio to you?</label>
      <br>
      <label class="uk-form-label">Not Clear At All</label>
      <label><input type="radio" class="uk-radio" value="1" name="radio_clear"> 1 </label>
      <label><input type="radio" class="uk-radio" value="2" name="radio_clear"> 2 </label>
      <label><input type="radio" class="uk-radio" value="3" name="radio_clear"> 3 </label>
      <label><input type="radio" class="uk-radio" value="4" name="radio_clear"> 4 </label>
      <label><input type="radio" class="uk-radio" value="5" name="radio_clear"> 5 </label>
      <label class="uk-form-label"> Very Clear </label>
    </div>
    <div class="uk-margin">
      <label class="uk-form-label">How easy was it to use Terrifio?</label>
      <br>
      <label class="uk-form-label">Not Clear At All</label>
      <label><input type="radio" class="uk-radio" value="1" name="radio_easy"> 1 </label>
      <label><input type="radio" class="uk-radio" value="2" name="radio_easy"> 2 </label>
      <label><input type="radio" class="uk-radio" value="3" name="radio_easy"> 3 </label>
      <label><input type="radio" class="uk-radio" value="4" name="radio_easy"> 4 </label>
      <label><input type="radio" class="uk-radio" value="5" name="radio_easy"> 5 </label>
      <label class="uk-form-label"> Very Clear </label>
    </div>
    <div class="uk-margin uk-form-horizontal">
      <label class="uk-form-label">What best describes where you are in the patent process?</label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I have an idea" name="radio_patent"> I have an idea</label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I have a prototype" name="radio_patent"> I have a prototype </label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I have reached out to a firm / patent professional" name="radio_patent"> I have reached out to a firm / patent professional </label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I am currently drafting my patent" name="radio_patent"> I am currently drafting my patent </label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I have already submitted a patent draft" name="radio_patent"> I have already submitted a patent draft </label>
      <label class="uk-form-label"><input type="radio" class="uk-radio" value="I am only looking for information" name="radio_patent"> I am only looking for information </label>
    </div>
    <div class="uk-margin uk-form-horizontal">
      <label class="uk-form-label">
       Did you notice the live chat feature?
     </label>
     <label class="uk-form-label"><input type="radio" name="radio_chat" class="uk-radio" value="yes"> Yes </label>
     <label class="uk-form-label"><input type="radio" name="radio_chat" class="uk-radio" value="no"> No </label>
   </div>
   <div class="uk-margin uk-form-horizontal">
    <label class="uk-form-label">What is your goal with Terrifio</label>

    <label class="uk-form-label"><input class="uk-radio" type="radio" name="radio_goal" value="To file a patent application"> To file a patent application</label>
    <label class="uk-form-label"><input class="uk-radio" type="radio" name="radio_goal" value="To better understand the patent process"> To better understand the patent process </label>
    <label class="uk-form-label"><input class="uk-radio" type="radio" name="radio_goal" value="To find a professional to help me">To find a professional to help me</label>
    <label class="uk-form-label"><input class="uk-radio" type="radio" name="radio_goal" value="To write my own patent draft">To write my own patent draft</label>
    <label class="uk-form-label"><input class="uk-radio" type="radio" name="radio_goal" value="other">Other <input class="uk-input" type="text" name="input_goal"></label>
  </div>
  <div class="uk-margin uk-form-horizontal">
    <label class="uk-form-label">Did you find the videos and popups useful when using Terrifio?</label>
    <label class="uk-form-label"><input type="radio" name="radio_video" class="uk-radio" value="yes">Yes</label>
    <label class="uk-form-label"><input type="radio" name="radio_video" class="uk-radio" value="no">No</label>

  </div>
  <div class="uk-margin">
    <label class="uk-form-label">Please describe any questions or comments you have about Terrifio</label>
    <input type="text" class="uk-input" name="comment">

  </div>
  <div class="uk-margin uk-form-horizontal">
    <label class="uk-form-label">Would you like to receive free patent information from Terrifio via email?</label>

    <label class="uk-form-label"><input type="radio" name="radio_video" class="uk-radio" value="yes">Yes</label>
    <label class="uk-form-label"><input type="radio" name="radio_video" class="uk-radio" value="no">No</label>
  </div>
</fieldset>
<button class="uk-button uk-button-default" type="submit">Submit</button>




</form>
<p class="uk-text-right">
  <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
  <button class="uk-button uk-button-primary" type="button">Save</button>
</p>
</div>
</div>
<!-- <div id="modal-card" uk-modal>
 <div class="uk-modal-dialog">
  <button class="uk-modal-close-default" type="button" uk-close></button>
  <div class="uk-modal-header">
   <h2 class="uk-modal-title">Welcome To Terrifio&trade;!</h2>
 </div>
 <div id="loading" class="uk-hidden">
   <div class="uk-modal-body">
     <div class="uk-margin">
       <h4 class="uk-h4">Processing Payment</h4>
       <div uk-spinner="ratio: 2"></div>
       <p class="uk-text-success" id="paymentNote">Securing connection...</p>
       <progress id="payLoading" class="uk-progress" value="10" max="100"></progress>
     </div>
   </div>
 </div>
 <div id="plan" class="uk-modal-body">
  <div class="uk-margin">
    <div class="uk-form-label">Select Plan:</div>
    <div class="uk-form-controls priceSelect">
      <label><input class="uk-radio" id="radio1" value="0" type="radio" checked name="radio1">Monthly at $9.99 / Month</label><br>
    </div>
  </div>

  <h4>Upgrade your Terrifio&trade; account for <strong><span class="price">$9.99</span></strong></h4>
  <div class="uk-margin">
    <fieldset class="uk-fieldset">
      <p class="uk-meta">If you have a promotional code enter it here:</p>
      <label for="promo" class="uk-form-label">Promo Code:</label>
      <input type="text" id="discountCode" name="promo"><p><strong class="info1"></strong></p>
    </fieldset>

  </div>


  <form action="/charge" method="post" id="payment-form">
    <div class="form-row">
      <label for="card-element">
        Credit or debit card
      </label>
      <div id="card-element"> --->
        <!-- A Stripe Element will be inserted here. -->
     <!--  </div> -->

      <!-- Used to display form errors. -->
      <!-- <div id="card-errors" role="alert"></div>
    </div>

    <button id="" class="uk-button uk-button-primary uk-align-center">Upgrade for <strong><span class="price">$9.99</span></strong></button>
    <p id="notice" class="uk-hidden uk-align-center uk-text-center">For the first month</p>
  </form>
  <p>Thank you for subscribing!</p>
</div>
<div class="uk-modal-footer uk-text-right">
  <button class="uk-button uk-button-primary uk-modal-close" type="button">Close</button>


</div>

</div>
</div> -->
<div id="modal-sections" uk-modal="bg-close:false; ">
 <div class="uk-modal-dialog">
  <button class="uk-modal-close-default" type="button" uk-close></button>
  <div class="uk-modal-header">
   <h2 class="uk-modal-title">Welcome To Terrifio&trade;!</h2>
 </div>
 <div class="uk-modal-body">
  <ul class="intro uk-text-center uk-switcher uk-align-center">
    <li><img src="./images/advisor-intro.png" style="width:350px"></li>
  </ul>
  <ul uk-switcher="connect: .intro" style="margin-left: auto; margin-right: 50%; float: right;" class="uk-text-center uk-dotnav">
    <li><a href="#">info1</a></li>
  </ul>
  <ul class="uk-switcher intro" style="padding-top:20px;">
    <li><p>Welcome to Terrifio&trade; Home of The Digital IP Advisor. To start your IP protection journey click on the NEW PROJECT button below or use the button located on the dashboard. </p>
      <a href="#" class="newProject"><button class="uk-align-center uk-text-center uk-button uk-button-primary">New Project</button></a>
    </li>
  </ul>


</div>
<div class="uk-modal-footer uk-text-right">
  <ul class="uk-switcher intro">
    <li><button  class="uk-button uk-button-default uk-modal-close" type="button">Close</button>
    </li>
  </ul>

</div>

</div>
</div>
<!-- /CONTENT -->
</div>

<script src="./dist/shepherd.js"></script>

<script src="./js/dashboard.js?v=1.0" type="text/javascript"></script>
<script src="./js/stepper.js"></script>
<div id="footer" class="uk-section uk-section-xsmall" style="background-color: rgba(0,0,0,0.15)">
  <div class="uk-container">
    <div class="uk-grid uk-child-width-1-2@s uk-text-center uk-grid-stack" data-uk-grid="">
      <div class="uk-text-small uk-text-muted uk-first-column uk-align-center">
        <a href="https://terrifio.co.uk">Copyright 2019 Terrifio &trade; All Rights Reserved.</a>
      </div>
    </div>
  </div>
</div>
<!-- Load More Javascript -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js" integrity="sha256-UGwvyUFH6Qqn0PSyQVw4q3vIX0wV1miKTracNJzAWPc=" crossorigin="anonymous"></script> -->
<script type="text/javascript">
      // Create a Stripe client.
      const firestore = firebase.firestore();
      const settings = {/* your settings... */ timestampsInSnapshots: true};
      firestore.settings(settings);
      //var stripe = Stripe('pk_test_mtu5IaBaufMduJaucUsR52f700ehQf34ZB'); //Development
      var stripe = Stripe(' pk_live_OkwDJd3ejoHYJBDZxKZFZfyE00i4hM8WST')

// Create an instance of Elements.
var elements = stripe.elements();

// Custom styling can be passed to options when creating an Element.
// (Note that this demo uses a wider set of styles than the guide below.)
var style = {
  base: {
    color: '#32325d',
    fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
    fontSmoothing: 'antialiased',
    fontSize: '16px',
    '::placeholder': {
      color: '#aab7c4'
    }
  },
  invalid: {
    color: '#fa755a',
    iconColor: '#fa755a'
  }
};

// Create an instance of the card Element.
var card = elements.create('card', {style: style});

// Add an instance of the card Element into the `card-element` <div>.
// card.mount('#card-element');
// card.addEventListener('change', function(event) {
//   var displayError = document.getElementById('card-errors');
//   if (event.error) {
//     displayError.textContent = event.error.message;
//   } else {
//     displayError.textContent = '';
//   }
// });
// // Create a token or display an error when the form is submitted.
// var form = document.getElementById('payment-form');
// form.addEventListener('submit', function(event) {
//   event.preventDefault();

//   stripe.createToken(card).then(function(result) {
//     if (result.error) {
//       // Inform the customer that there was an error.
//       var errorElement = document.getElementById('card-errors');
//       errorElement.textContent = result.error.message;
//     } else {
//       // Send the token to your server.
//       stripeTokenHandler(result.token);
//       $('#plan').addClass('uk-hidden');
//       $('#loading').removeClass('uk-hidden');
//       var loadValue = 10;
//       var animate = setInterval(function () {

//         loadValue += 10;

//         switch(true){
//           case loadValue <= 30:
//           jQuery('#paymentNote').text('Sending details...');
//           break;
//           case loadValue <= 50 && loadValue > 30:
//           jQuery('#paymentNote').text('Verifying...');
//           break;
//           case loadValue > 50 && loadValue <= 100:
//           jQuery('#paymentNote').text('Waiting for response, Please wait...');
//           break;
//         }

//         jQuery('#payLoading').val(loadValue);

//         if (loadValue >= 100) {
//           clearInterval(animate);
//         }

//       }, 200);
//       console.log(result)
//     }
//   });
// });

function stripeTokenHandler(token){

  firebase.firestore().collection('stripe_customers').doc(currentUser.uid).collection('tokens').add({token: token.id}).then(() => {
    UIkit.notification('Card added successfully', {status: 'success'});
    subscribeUser()
  }).catch((error) => {
    UIkit.notification('Failed to add card', {status: 'danger'});
  });

}

function subscribeUser(){

  firebase.firestore().collection('stripe_customers').doc(data.currentUser.uid).collection('charges').add({
    source: data.newCharge.source,
    discount: data.newCharge.discount
  });
  firebase.database().ref('user/'+ currentUser.uid +'/userMeta/').on('value', function(snapshot) {
    if (snapshot.val().subscribed == true && typeof snapshot.val().subscribed !== 'undefined'){
      UIkit.notification('You have been upgraded!', {status: 'success'});
      UIkit.modal('#modal-card').hide();
      $('.upgradeNotice').addClass('uk-hidden');
      $('.newProject').attr('href', '/digitalipadvisor');
      $('.newProject').attr('onClick', '');

    }
  });
}

$('.priceSelect').on('change', function(){
  var planDuration = $('.uk-radio[name=radio1]:checked', '.priceSelect').val();

  if(planDuration == "1"){
    $('.price').empty();
    $('.price').text("$9.99")
  }else if (planDuration == "0"){
    $('.price').empty();
    $('.price').text("$29.99")
  }

});

$('#discountCode').on('input', function(){


  data.newCharge.discount = $(this).val();
  if (data.newCharge.discount.toUpperCase() == "LTW2019"){
   data.newCharge.discount = "LTW2019";
   $('#discountCode').addClass('uk-text-success');
   $('#discountCode').removeClass('uk-text-warning');
   $('.info1').text('First month $6.99!');
   $('.price').empty();
   $('.price').text("$9.99")
   $('#notice').removeClass('uk-hidden')
 }else{
   $('.price').empty();
   $('.price').text("$29.99")
   $('#notice').addClass('uk-hidden');
   data.newCharge.discount = "";
 }

});

</script>

<!-- JS FILES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/js/uikit-icons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<!--    <script src="./js/chartScripts.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.12/jquery.transit.min.js" integrity="sha256-rqEXy4JTnKZom8mLVQpvni3QHbynfjPmPxQVsPZgmJY=" crossorigin="anonymous"></script>
<script src="./js/notyf.min.js"></script>
<script src="./js/script.js"></script>

</main>
</body>
</html>