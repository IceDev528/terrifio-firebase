<!DOCTYPE html>
<html lang="en">
<head>

  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/css/uikit.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/js/uikit.min.js"></script>
  <link rel="apple-touch-icon" sizes="57x57" href="logo/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="logo/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="logo/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="logo/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="logo/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="logo/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="logo/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="logo/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="logo/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="logo/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="logo/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="logo/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="logo/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="logo/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <link rel="icon" href="/wp-content/uploads/2019/04/cropped-ms-icon-310x310-32x32.png" sizes="32x32">


  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- <link rel="stylesheet" href="./css/style.css" /> -->
  <link rel="stylesheet" href="./css/notyf.min.css" />
  <link rel="stylesheet" type="text/css" href="./css/dashboard.css?v=1.0">
  <script src="./js/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-firestore.js"></script>
  <script type="text/javascript" src="./js/firebase_init.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="./js/uikit-icons.min.js" ></script>
  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
      var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
      s1.async=true;
      s1.src='https://embed.tawk.to/5cd1f2bdd07d7e0c639267a6/default';
      s1.charset='UTF-8';
      s1.setAttribute('crossorigin','*');
      s0.parentNode.insertBefore(s1,s0);
    })();
  </script>
  <!--End of Tawk.to Script-->
  <!-- start Mixpanel --><script type="text/javascript">(function(c,a){if(!a.__SV){var b=window;try{var d,m,j,k=b.location,f=k.hash;d=function(a,b){return(m=a.match(RegExp(b+"=([^&]*)")))?m[1]:null};f&&d(f,"state")&&(j=JSON.parse(decodeURIComponent(d(f,"state"))),"mpeditor"===j.action&&(b.sessionStorage.setItem("_mpcehash",f),history.replaceState(j.desiredHash||"",c.title,k.pathname+k.search)))}catch(n){}var l,h;window.mixpanel=a;a._i=[];a.init=function(b,d,g){function c(b,i){var a=i.split(".");2==a.length&&(b=b[a[0]],i=a[1]);b[i]=function(){b.push([i].concat(Array.prototype.slice.call(arguments,
0)))}}var e=a;"undefined"!==typeof g?e=a[g]=[]:g="mixpanel";e.people=e.people||[];e.toString=function(b){var a="mixpanel";"mixpanel"!==g&&(a+="."+g);b||(a+=" (stub)");return a};e.people.toString=function(){return e.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)c(e,l[h]);var f="set set_once union unset remove delete".split(" ");e.get_group=function(){function a(c){b[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));e.push([d,call2])}}for(var b={},d=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<f.length;c++)a(f[c]);return b};a._i.push([b,d,g])};a.__SV=1.2;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===c.location.protocol&&"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js";d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d)}})(document,window.mixpanel||[]);
mixpanel.init("0cb54d95b1c1b3a8ae820f4ef3e4ad54");</script><!-- end Mixpanel -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-137827565-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-137827565-2');
</script>

  <style type="text/css">
    .reportCard{
      background-color: #f8f9fe;
    }
    article{
      /*-webkit-user-select: none;*/ /* Safari */        
      /*-moz-user-select: none;*/ /* Firefox */
      /*-ms-user-select: none;*/ /* IE10+/Edge */
      /*user-select: none;*/ /* Standard */
      color: #666 !important;

    }
    img.vert-move {
      -webkit-animation: mover 1s infinite  alternate;
      animation: mover 1s infinite  alternate;
    }
    img.vert-move {
      -webkit-animation: mover 1s infinite  alternate;
      animation: mover 1s infinite  alternate;
    }
    @-webkit-keyframes mover {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
    @keyframes mover {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
    #nav-top{

      float:right;

    }

    #sidebar{
      top:0px;
      max-width:15% !important;
    }
    .nav-shrink{
      margin-left: 15% !important;

    }
    .uk-button-primary{
      background-color:#4054be !important;
    }
    .horizontal-center{
      margin-top: 50vh;
    }
    .floating {  
      animation-name: floating;
      animation-duration: 3s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
      width:30px;
    }

    @keyframes floating {
      from { transform: translate(0,  0px); }
      65%  { transform: translate(0, 15px); }
      to   { transform: translate(0, -0px); }    
    }
    #my-id > .uk-modal-dialog{
      height:100vh;
      top: -10px;
      overflow: hidden;

    }
    .pre-load{
      height: 100%;
      width: 100%;
      z-index: 999999;
      position: absolute;
    }
    #proCard{
      margin-top: 30px;
      margin-bottom: 30px;
    }
  </style>
  <script type="text/javascript">
  </script>
  <script>

    UIkit.util.ready(function(){
      var loadValue = 10;
      var animate = setInterval(function () {

        loadValue += 10;

        switch(true){
          case loadValue <= 30:
          jQuery('#loadingInfo').text('Loading Page Content...');
          break;
          case loadValue <= 50 && loadValue > 30:
          jQuery('#loadingInfo').text('Securing Connection...');
          break;
          case loadValue > 50 && loadValue <= 100:
          jQuery('#loadingInfo').text('Rendering Data...');
          break;
        }

        jQuery('#js-loading').val(loadValue);

        if (loadValue >= 100) {
          clearInterval(animate);
          $('main').removeClass('uk-hidden');
          $('.pre-load').addClass('uk-animation-slide-bottom uk-hidden');
          var confirmState = false;

        }

      }, 200);

    });
    var strip = Stripe('pk_test_mtu5IaBaufMduJaucUsR52f700ehQf34ZB');
    var currentUser;
    var data = {
      currentUser: null,
      sources: {},
      stripeCustomerInitialized: false,
      newCreditCard: {
        number: '424242424242',
        cvc: '111',
        exp_month: 1,
        exp_year: 2020,
        address_zip: '00000'
      },
      charges: {},
      newCharge: {
        source: null,
        discount: ''
      }
    };
    firebase.auth().onAuthStateChanged(function(user){
      if(user){
        currentUser = firebase.auth().currentUser;
        
        $('.profile-img').attr("src","" + currentUser.photoURL);
        $('.user-name').text(currentUser.displayName);
        $('.name-upload').attr("placeholder", currentUser.displayName);
        data.currentUser = firebase.auth().currentUser;
        initStripeCustomer();
      }else{
        window.location.href="/login";
      }
    });

    var initStripeCustomer = () => {
      firebase.firestore().collection('stripe_customers').doc(`${data.currentUser.uid}`).onSnapshot(snapshot => {
        data.stripeCustomerInitialized = (snapshot.data() !== null);
      }, () => {
        data.stripeCustomerInitialized = false;
      });
      firebase.firestore().collection('stripe_customers').doc(`${data.currentUser.uid}`).collection('sources').onSnapshot(snapshot => {
       let newSources = {};
       $('.sources').empty();
       snapshot.forEach(doc => {
        const id = doc.id;
        newSources[id] = doc.data();
        console.log(newSources[id])
        $('.sources').append('<li>card: ...'+ newSources[id].last4 +' Exp: '+newSources[id].exp_month+'/'+newSources[id].exp_year+'  '+ newSources[id].brand +'</li>');
      })
       data.sources = newSources;
     }, () => {
      data.sources = {};
    });
      firebase.firestore().collection('stripe_customers').doc(`${data.currentUser.uid}`).collection('charges').onSnapshot(snapshot => {
        let newCharges = {};
        snapshot.forEach(doc => {
         const id = doc.id;
         newCharges[id] = doc.data();
         console.log(newCharges[id]);
       })
        data.charges = newCharges;
      }, () => {
        data.charges = {};
      });
    }
    var submitNewCreditCard = () => {
     stripe.card.createToken({
      number: data.newCreditCard.number,
      cvc: data.newCreditCard.cvc,
      exp_month: data.newCreditCard.exp_month,
      exp_year: data.newCreditCard.exp_year,
      address_zip: data.newCreditCard.address_zip
    }, (status, response) => {
      if (response.error) {
        data.newCreditCard.error = response.error.message;
        //Notify User of failed addition of card.
      } else {
        //Notify User of a successful payment being created.
        firebase.firestore().collection('stripe_customers').doc(data.currentUser.uid).collection('tokens').add({token: response.id}).then(() => {
          data.newCreditCard = {
            number: '',
            cvc: '',
            exp_month: 1,
            exp_year: 2007,
            address_zip: ''
          };
        });
        
      }
    });
   }

   var submitNewCharge = () => {
    firebase.firestore().collection('stripe_customers').doc(data.currentUser.uid).collection('charges').add({
      source: data.newCharge.source,
      discount: data.newCharge.discount
    });
  }


</script>
</head>
<body>
  <div class="pre-load uk-inline uk-animation-reverse">
    <div class="uk-position-center uk-overlay">
      <img class="floating uk-align-center" style="width:100px;" src="./images/logo.png">
      <progress id="js-loading" class="uk-progress" value="10" max="100"></progress>
      <h4 class="uk-h4">Welcome to Terrifio&trade;!</h4>
      <p id="loadingInfo">Loading Please Wait...</p>
    </div>
  </div>
  <main class="uk-hidden">
    <!--HEADER-->
    <header id="top-head" class="uk-position-fixed">
      <div style="min-height:50px;" class="uk-container uk-container-expand uk-background-primary">
        <nav class="uk-navbar uk-light" data-uk-navbar="mode:click; duration: 250">
          <div class="uk-navbar-left">
            <div class="uk-navbar-item uk-hidden@m">
              <a class="uk-logo" href="/"><img class="custom-logo" src="./images/logo.png" alt=""></a> 
            </div>
            <ul class="uk-navbar-nav uk-visible@m">
              <li>
                <a href="#">Settings <span data-uk-icon="icon: triangle-down"></span></a>
                <div class="uk-navbar-dropdown">
                  <ul class="uk-nav uk-navbar-dropdown-nav">
                    <li class="uk-nav-header">Your Account</li>
                    <!-- <li><a href="#"><span data-uk-icon="icon: info"></span> Summary</a></li> -->
                    <li><a href="/account"><span data-uk-icon="icon: settings"></span> Settings</a></li>
                    <li class="uk-nav-divider"></li>
                    <li><a href="/user"><span data-uk-icon="icon: image"></span> Your Profile</a></li>
                    <li class="uk-nav-divider"></li>
                    <li><a onClick="firebase.auth().signOut();"><span data-uk-icon="icon: sign-out"></span> Logout</a></li>
                  </ul>
                </div>
              </li>
            </ul>
            <!-- <div class="uk-navbar-item">
              <a href="/digitalipadvisor"><button  class="uk-button uk-button-default">
                New Project
              </button></a>
            </div> -->
            <div class="uk-navbar-item uk-visible@s">
              <!-- <form class="uk-search uk-search-default">
                <span data-uk-search-icon></span>
                <input class="uk-search-input search-field" type="search" placeholder="Search">
              </digitalipadvisor> -->
            </div>
          </div>
          <div class="uk-navbar-right">
            <ul class="uk-navbar-nav">
              <li class="uk-visible@m"><a href="/user" data-uk-icon="icon:user" title="Your profile" data-uk-tooltip></a></li>
              <li class="uk-visible@m"><a href="/account" data-uk-icon="icon: settings" title="Settings" data-uk-tooltip></a></li>
              <li class="uk-visible@m"><a onClick="logout();" data-uk-icon="icon:  sign-out" title="Sign Out" data-uk-tooltip></a></li>
              <li><a class="uk-navbar-toggle uk-hidden@m" uk-toggle="target: #left-col; cls: uk-visible@m" data-uk-navbar-toggle-icon title="Menu" data-uk-tooltip></a></li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!--/HEADER-->
    <!-- LEFT BAR -->
    <aside id="left-col" class="uk-light uk-visible@m">
      <div class="left-logo uk-align-center uk-flex uk-flex-middle">
        <a href="/"><img class="custom-logo" src="./images/logo.png" alt=""></a>
        <h4 class="uk-h4" style="padding-bottom: 15px;">Terrifio &trade;</h4>
      </div>
      <div class="left-content-box  content-box-dark">
        <a href="/user">
          <img src="" alt="" class="uk-border-circle profile-img">
        </a>
        
        <h4 class="uk-text-center uk-margin-remove-vertical text-light"></h4>
        
        <div class="uk-position-relative uk-text-center uk-display-block">
          <a href="#" class="uk-text-small uk-text-muted user-name uk-display-block uk-text-center" data-uk-icon="icon: triangle-down; ratio: 0.7">User</a>
          <!-- user dropdown -->
          <div class="uk-dropdown user-drop" data-uk-dropdown="mode: click; pos: bottom-center; animation: uk-animation-slide-bottom-small; duration: 150">
            <ul class="uk-nav uk-dropdown-nav uk-text-left">
              <li><a href="/account"><span data-uk-icon="icon: settings"></span> Settings</a></li>
              <li class="uk-nav-divider"></li>
              <li><a href="/user"><span data-uk-icon="icon: image"></span> Your Profile</a></li>
              <li class="uk-nav-divider"></li>
              <li><a onClick="firebase.auth().signOut();"><span data-uk-icon="icon: sign-out"></span> Logout</a></li>
            </ul>
          </div>
          <!-- /user dropdown -->
        </div>
      </div>
      
      <div class="left-nav-wrap">
        <ul class="uk-nav uk-nav-default uk-nav-parent-icon" data-uk-nav>
          <li class="uk-nav-header">ACTIONS</li>
          <li><a href="/"><span data-uk-icon="icon: thumbnails" class="uk-margin-small-right"></span>Dashboard</a></li>
          <li><a href="/calculator"><span data-uk-icon="icon: credit-card" class="uk-margin-small-right"></span>Cost Forecaster</a></li>
<!--           <li><a class="uk-disabled" title="Coming Soon" href="#"><span data-uk-icon="icon: calendar" class="uk-margin-small-right"></span>Calendar</a>
          </li> -->
<!--          
          <li><a href="#"><span data-uk-icon="icon: thumbnails" class="uk-margin-small-right"></span>Featured Content</a></li>
          <li><a href="#"><span data-uk-icon="icon: lifesaver" class="uk-margin-small-right"></span>Tips</a></li> -->
          <li class="uk-parent">
            <a href="#"><span data-uk-icon="icon: comments" class="uk-margin-small-right"></span>Info</a>
            <ul class="uk-nav-sub">
              <li><a href="/privacy">Privacy Policy</a></li>
              <li><a href="/terms">Terms & Conditions</a></li>
            </ul>
          </li>
        </ul>
        <div class="left-content-box uk-margin-top">
        </div>
        
      </div>
      <div class="bar-bottom">
        <ul class="uk-subnav uk-flex uk-flex-center uk-child-width-1-5" data-uk-grid>
          <li>
            <a href="/" class="uk-icon-link" data-uk-icon="icon: home" title="Home" data-uk-tooltip></a>
          </li>
          <li>
            <a href="/account" class="uk-icon-link" data-uk-icon="icon: settings" title="Settings" data-uk-tooltip></a>
          </li>
          <!-- <li>
            <a href="#" class="uk-icon-link" data-uk-icon="icon: social"  title="Social" data-uk-tooltip></a>
          </li> -->
          
          <li>
            <a onClick="firebase.auth().signOut();" class="uk-icon-link" data-uk-tooltip="Sign out" data-uk-icon="icon: sign-out"></a>
          </li>
        </ul>
      </div>
    </aside>
    <!-- /LEFT BAR -->
    <script type="text/javascript">
      function deleteReport(reportSuffix, reportPrefix, formName){
        var reportID = String(reportPrefix) + String(reportSuffix);
        console.log(reportPrefix)
        if(confirm('Are you sure you wish to delete '+ formName + '?') == true){
          var parent = database.ref('user/' + userID+'/'+reportID);
          parent.on('child_removed', function (snapshot) {
            console.log(snapshot);
          })
          parent.remove();
        } 
      }
    </script>
    <link href="./datedropper/datedropper.css" rel="stylesheet" type="text/css" />
    <script src="./datedropper/datedropper.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./css/datepicker.css">
    <script src="https://unpkg.com/ionicons@4.5.0/dist/ionicons.js"></script>

    <!-- CONTENT -->
    <div id="content" class="uk-background-cover uk-overlay uk-overlay-cover uk-overlay-default " style="background-image: url('./images/background.jpg')" data-uk-height-viewport="expand: true">
      <div class="uk-container uk-container-expand">
        <hr>
        <div class="uk-grid uk-grid-medium" data-uk-grid>

          <!-- panel -->
          <div class="uk-width-2-3@l uk-align-left">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover">
              <div class="uk-card-header">
                <div class="uk-grid uk-grid-small">
                  <div class="uk-width-auto"><h4>Profile</h4></div>
                  <div class="uk-width-expand uk-text-right panel-icons">
                    <!-- <a href="#" class="uk-icon-link" title="Move" data-uk-tooltip data-uk-icon="icon: move"></a>
                      <a href="#" class="uk-icon-link" title="Configuration" data-uk-tooltip data-uk-icon="icon: cog"></a> -->
                      <a href="#" class="uk-icon-link" title="Close" data-uk-tooltip data-uk-icon="icon: cross"></a>
                    </div>
                  </div>
                </div>
                <ul uk-switcher="connect: .accountBody;">
                  <li><a href="#">Account</a></li>
                  <!-- <li><a href="#">Payments & Subscriptions</a></li> -->
                </ul>
                <ul class="uk-switcher accountBody">
                  <li>                
                    <div class="uk-card-body">
                      <div class="uk-margin">
                        <h4 class="uk-h4">Change Email</h4>
                        <input type="input" name="email" class="uk-input uk-width-1-2@s" onChange="$('#email').removeClass('uk-form-success'); $('#email').removeClass('uk-form-danger');" id="email">
                        <button class="uk-button uk-button-default uk-width-1-2@s" onClick="updateEmail();">Update Email</button>

                      </div>  
                      <div class="uk-margin">
                        <h4 class="uk-h4">Change Password</h4>
                        <input type="password" name="password" class="uk-input uk-width-1-2@s" onChange="$('#password').removeClass('uk-form-success'); $('#password').removeClass('uk-form-danger');" id="password">
                        <input type="password" name="passwordValid" class="uk-input uk-width-1-2@s" onChange="$('#passwordValid').removeClass('uk-form-success'); $('#passwordValid').removeClass('uk-form-danger');" id="passwordValid">
                        <button class="uk-button uk-button-default uk-width-1-2@s" onClick="updatePassword();">Update Email</button>

                      </div>  
                      <div class="uk-margin">
                        <h4 class="uk-h4">Delete Account</h4>
                        <p class="uk-meta">This will delete your account and delete all data.</p>
                        <button class="uk-form-danger uk-button" onClick="deleteAccount();">Delete Account</button>
                      </div>
                    </div>
                  </li>
                  <li>

                    <div class="uk-card-body">
                      <div class="uk-margin">
                        <h4 class="uk-h4">Credit Card</h4>
                        <ul class="sources">

                        </ul>
                        <!-- Here I need to put a stripe elements input -->
                        <!-- And I need to list current cards to set the 'default' -->
                        

                      </div>  
<!--                       <div class="uk-margin">
                        <h4 class="uk-h4">Your Subscription</h4>
                        
                      </div>  --> 
                      <div class="uk-margin">
                        <h4 class="uk-h4">Cancel Subscription</h4>
                        <button class="uk-form-danger uk-button" onClick="cancelSub();">Cancel Subscription</button>
                      </div>
                    </div>
                  </li>
                </ul>

              </div>
            </div>
            <!-- /panel -->
          </div>
        </div>
      </div>
      <div id="footer" class="uk-section uk-section-xsmall" style="background-color: rgba(0,0,0,0.15)">
        <div class="uk-container">
          <div class="uk-grid uk-child-width-1-2@s uk-text-center uk-grid-stack" data-uk-grid="">
            <div class="uk-text-small uk-text-muted uk-first-column uk-align-center">
              <a href="https://terrifio.co.uk">Copyright 2019 Terrifio &trade; All Rights Reserved.</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Load More Javascript -->
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js" integrity="sha256-UGwvyUFH6Qqn0PSyQVw4q3vIX0wV1miKTracNJzAWPc=" crossorigin="anonymous"></script> -->
      <script>
        function updateEmail(){
          currentUser.updateEmail($('#email').val()).then(function(){
            $('#email').addClass('uk-form-success');
            UIkit.notification('Email Updated Successfully', {status:'success'});
          }).catch(function(error){
            console.log(error); 
            $('#email').addClass('uk-form-danger');
            UIkit.notification('Email Failed to Update: ' + error.code, {status:'danger'});
          });
        }
        function updatePassword(){
          var password = $('#password').val();
          var passwordValid = $('#passwordValid').val();

          if(password == passwordValid){
            currentUser.updatePassword(password).then(function(){
              $('#password').addClass('uk-form-success');
              $('#passwordValid').addClass('uk-form-success');
              UIkit.notification('Password Updated Successfully', {status:'success'});
            }).catch(function(error){
              console.log(error);
              $('#password').addClass('uk-form-danger');
              $('#passwordValid').addClass('uk-form-danger');
              UIkit.notification('Password Failed to Update: ' + error.code, {status:'danger'});
            });
          }else{
            $('#password').addClass('uk-form-danger');
            $('#passwordValid').addClass('uk-form-danger');
          }
        }
        function updateUser(){
          var name = $('.name-upload').val();
          var bio = $('.bio-upload').val();

          if(name){
            currentUser.updateProfile({
              displayName : name
            }).then(function(){

            }).catch(function(error){
              console.log(error);
            });
          }
          if(bio){
            console.log('Uploaded ', bio)
            firebase.database().ref('user/' + currentUser.uid + '/userMeta').update({
              userBio : bio
            });
          }
          $('.save-button').addClass('uk-form-success');


        }

        var bar = document.getElementById('js-progressbar');
        var storage = firebase.storage();
        var storageRef = storage.ref();

        UIkit.upload('.js-upload', {

          url: '',
          allow : '*.(jpg|jpeg|gif|png)',
          filelimit: 1,

          beforeSend: function () {
            console.log('beforeSend', arguments);
          },
          beforeAll: function () {
            console.log('beforeAll', arguments);
            console.log(arguments[1]);
            var blob = new Blob(arguments[1], {type: 'image/png'})
            console.log(blob)
            firebaseUpload(blob);
          },
          load: function () {
            console.log('load', arguments);
          },
          error: function () {
            console.log('error', arguments);
          },
          complete: function () {
            console.log('complete', arguments);
          },

          loadStart: function (e) {
            console.log('loadStart', arguments);

            bar.removeAttribute('hidden');
          },

          progress: function (e) {
            console.log('progress', arguments);


          },

          loadEnd: function (e) {
            console.log('loadEnd', arguments);


          },

          completeAll: function () {
            console.log('completeAll', arguments);
          }

        });
        function firebaseUpload(file){
          bar.removeAttribute('hidden');

          var uploadTask = storageRef.child('images/'+ currentUser.uid +'.png').put(file);

          // Register three observers:
          // 1. 'state_changed' observer, called any time the state changes
          // 2. Error observer, called on failure
          // 3. Completion observer, called on successful completion
          uploadTask.on('state_changed', function(snapshot){
            // Observe state change events such as progress, pause, and resume
            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            bar.max = 100;
            bar.value = progress;
            console.log('Upload is ' + progress + '% done');
            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED: // or 'paused'
              console.log('Upload is paused');
              break;
              case firebase.storage.TaskState.RUNNING: // or 'running'
              console.log('Upload is running');
              break;
            }
          }, function(error) {
            // Handle unsuccessful uploads
          }, function() {
            // Handle successful uploads on complete
            // For instance, get the download URL: https://firebasestorage.googleapis.com/...
            uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
              console.log(downloadURL)
              currentUser.updateProfile({
                photoURL: downloadURL
              }).then(function(){

              }).catch(function(error){
                console.log(error);
              });
            });
          });
        }

        function reauthenticate(currentPassword) {

          var user = firebase.auth().currentUser;
          var cred = firebase.auth.EmailAuthProvider.credential(
            user.email, currentPassword)
          user.reauthenticateAndRetrieveDataWithCredential(cred).then(function(){
           var parent = database.ref('user/' + currentUser.uid + '/');
           parent.remove().then(function(){
            currentUser.delete().then(function(){
              alert('Account Deleted');
              window.location.href= '/login'
            });
          });
         }).catch(function(error){
          UIkit.notification('Failed to authenticate '+ error.code,{status:'danger'});
          return false;
        });

       }

       function deleteAccount(){
         var reauth = reauthenticate(prompt('Are you sure you wish to delete your account? This action cannot be undone! Enter your password to continue.',""))




       }

     </script>
     <!-- OFFCANVAS -->
    <!-- <div id="offcanvas-nav" data-uk-offcanvas="flip: true; overlay: true">
      <div class="uk-offcanvas-bar uk-offcanvas-bar-animation uk-offcanvas-slide">
        <button class="uk-offcanvas-close uk-close uk-icon" type="button" data-uk-close></button>
        
      </div>
    </div> -->
    <!-- /OFFCANVAS -->
    
    <!-- JS FILES -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.2/js/uikit-icons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <!--    <script src="./js/chartScripts.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.12/jquery.transit.min.js" integrity="sha256-rqEXy4JTnKZom8mLVQpvni3QHbynfjPmPxQVsPZgmJY=" crossorigin="anonymous"></script>
    <script src="./js/notyf.min.js"></script>
    <!-- Required Overall Script -->
<!-- <script src="./js/script.js"></script>
--><!-- Status Updater -->
<script src="./js/status.js"></script>
<!-- Sample Charts -->
<!-- <script src="./js/charts.js"></script> -->
<!-- Sample Notifications -->
<!-- <script src="./js/notification.js"></script> -->

</main>
</body>
</html>